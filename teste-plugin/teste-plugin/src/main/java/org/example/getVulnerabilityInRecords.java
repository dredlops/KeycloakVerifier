package org.example;

import org.json.JSONArray;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.Iterator;

public class getVulnerabilityInRecords {
    private static final String FILE = "vulnerabilities.log";

    private static JSONArray vulnerabilities;

    public getVulnerabilityInRecords() throws IOException {
        vulnerabilities=new JSONArray();
        String current="";
        BufferedReader buff = new BufferedReader(new FileReader(FILE));
        while( (current = buff.readLine()) != null ) {
            vulnerabilities.put(new JSONObject(current));
        }
    }

    public JSONObject getVulnerability(String cve){
        Iterator it= vulnerabilities.iterator();
        JSONObject object;
        while (it.hasNext()){
            object=(JSONObject) it.next();
            if(object.get("cve").equals(cve))
                return object;
        }
        return null;
    }

    public String[] get(String key) {
        String[] response = new String[vulnerabilities.length()];
        int counter=0;
        Iterator it= vulnerabilities.iterator();
        JSONObject object;
        while (it.hasNext()){
            object=(JSONObject) it.next();
            response[counter++]=object.get(key).toString();
        }
        return response;
    }

    /*
    Verifies if a CVE as a verification to be done, by checking "url" parameter on the log file
     */
    public boolean hasVerificationAvailable(String cve){
        Iterator it = vulnerabilities.iterator();
        JSONObject object;
        while (it.hasNext()){
            object=(JSONObject) it.next();
            if(object.get("cve").toString().equals(cve)){
                if(object.get("url").toString()!=null)
                    return true;
            }
        }
        return false;
    }

    /*
    Returns the value of a given key for a given CVE
     */
    public String getValueOf(String cve, String key){
        Iterator it = vulnerabilities.iterator();
        JSONObject object;
        while (it.hasNext()){
            object=(JSONObject) it.next();
            if(object.get("cve").toString().equals(cve)){
                return object.get(key).toString();
            }
        }
        return null;
    }
}
